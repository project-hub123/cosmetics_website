from app import create_app, db
from app.models import User, Category, Article, News
from werkzeug.security import generate_password_hash
from datetime import datetime
import random

"""
init_content.py — наполнение сайта контентом.

Запуск:
    python init_content.py
"""


# -------------------------------------------------------------
#   ТЕКСТЫ ДЛЯ СТАТЕЙ И НОВОСТЕЙ
# -------------------------------------------------------------

ARTICLE_TEXT = """
Косметическая индустрия развивается стремительно, и современные средства 
ухаживают не только за внешним видом, но и поддерживают здоровье кожи. 
При регулярном использовании косметики, подобранной по типу кожи, можно 
значительно улучшить её состояние. Важно обращать внимание на состав, 
избегать агрессивных компонентов, соблюдать режим ухода и использовать 
качественные средства производителя.
"""

NEWS_TEXT = """
Компания расширяет линейку продукции, внедряя инновационные разработки и 
натуральные ингредиенты. Новые продукты уже доступны в каталоге, а в 
ближайшее время планируется запуск специальных акций и скидок.
"""


# -------------------------------------------------------------
#   НАБОР ДАННЫХ
# -------------------------------------------------------------

CATEGORIES = [
    ("skin", "Уход за кожей"),
    ("hair", "Уход за волосами"),
    ("makeup", "Макияж"),
    ("perfume", "Парфюмерия"),
    ("body", "Уход за телом"),
]

ARTICLES_TITLES = {
    "skin": [
        "5 шагов к идеальной коже лица",
        "Как выбрать крем для своего типа кожи",
        "Ошибки в уходе за кожей",
        "Натуральные средства для очищения кожи",
        "Как восстановить кожу после стресса"
    ],
    "hair": [
        "Секреты ухода за волосами",
        "Как выбрать шампунь",
        "Увлажнение и питание волос",
        "Как бороться с выпадением волос",
        "Правильный уход за окрашенными волосами"
    ],
    "makeup": [
        "10 трендов макияжа",
        "Как подобрать тональную основу",
        "Правильное нанесение румян",
        "Советы по макияжу глаз",
        "Как создать стойкий макияж"
    ],
    "perfume": [
        "Как выбрать идеальный аромат",
        "Классификация парфюмов",
        "ТОП-5 женских ароматов",
        "Как правильно наносить аромат",
        "Что влияет на стойкость запаха"
    ],
    "body": [
        "Уход за телом: основные правила",
        "Средства для питания кожи тела",
        "Как выбрать скраб",
        "Польза сухого массажа",
        "Как ухаживать за кожей летом"
    ]
}

NEWS_TITLES = [
    "Запуск новой линии натуральной косметики",
    "Большие скидки на зимнюю коллекцию",
    "Обновление каталога: новинки недели",
    "Теперь мы доставляем по всей стране",
    "Открытие фирменного магазина",
    "Новый парфюм сезона",
    "Пополнение линейки ухода за волосами",
    "Старт весенней распродажи",
    "Совместная акция с партнёрами",
    "Компания получила награду качества"
]


# -------------------------------------------------------------
#   ГЕНЕРАЦИЯ ДАННЫХ
# -------------------------------------------------------------

app = create_app()

with app.app_context():
    print("Создаю таблицы (если отсутствуют)...")
    db.create_all()

    # -------------------------------
    #   АДМИНИСТРАТОР
    # -------------------------------
    if not User.query.filter_by(username="admin").first():
        admin = User(
            username="admin",
            email="admin@example.com",
            role="admin",
            password=generate_password_hash("admin123")
        )
        db.session.add(admin)
        print("Создан администратор (admin / admin123)")

    # -------------------------------
    #   КАТЕГОРИИ
    # -------------------------------
    created_categories = {}

    for slug, name in CATEGORIES:
        category = Category.query.filter_by(slug=slug).first()
        if not category:
            category = Category(slug=slug, name=name)
            db.session.add(category)
            print(f"Добавлена категория: {name}")
        created_categories[slug] = category

    # -------------------------------
    #   СТАТЬИ
    # -------------------------------
    all_articles = []

    for slug, titles in ARTICLES_TITLES.items():
        category = created_categories[slug]

        for title in titles:
            article = Article.query.filter_by(title=title).first()
            if not article:
                article = Article(
                    title=title,
                    content=ARTICLE_TEXT,
                    category_id=category.id,
                    author_id=1,  # admin
                    created_at=datetime.utcnow(),
                    image=None
                )
                db.session.add(article)
                all_articles.append(article)
                print(f"Статья добавлена: {title}")

    # -------------------------------
    #   НОВОСТИ
    # -------------------------------
    for title in NEWS_TITLES:
        news = News.query.filter_by(title=title).first()
        if not news:
            news = News(
                title=title,
                content=NEWS_TEXT,
                created_at=datetime.utcnow(),
                image=None
            )
            db.session.add(news)
            print(f"Новость добавлена: {title}")

    db.session.commit()

    print("\nГотово! Контент успешно загружен.")
